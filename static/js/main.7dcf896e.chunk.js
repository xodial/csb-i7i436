(this["webpackJsonpreact-18"]=this["webpackJsonpreact-18"]||[]).push([[0],{22:function(t,e,n){"use strict";n.r(e);var a,c=n(9),r=n(1),o=n(4),i=n(7),u=n(3),s=n(11),l=new Intl.DateTimeFormat("default",{dateStyle:"medium"}),j=new Intl.DateTimeFormat("default",{hour:"2-digit",minute:"2-digit"});function b(t){return f(t).toISOString().split("T")[0]}function f(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,e=new Date(t);return e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),e}function d(t){return l.format(new Date(t))}function m(t){return j.format(new Date(t))}function O(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.filter((function(t){return!!t})).join(" ")}function v(){return p.apply(this,arguments)}function p(){return(p=Object(i.a)(Object(o.a)().mark((function t(){var e,n,c,r;return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new Promise((function(t,e){navigator.geolocation.getCurrentPosition(t,(function(t){e(t)}))}));case 2:return e=t.sent,n=e.coords,c=n.latitude,r=n.longitude,a={latitude:c,longitude:r},t.abrupt("return",a);case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function h(t,e){var n=t.latitude,a=t.longitude,c=e.latitude,r=e.longitude,o=x(c-n),i=x(r-a),u=Math.sin(o/2)*Math.sin(o/2)+Math.cos(x(n))*Math.cos(x(c))*Math.pow(Math.sin(i/2),2);return 1e3*(6371*(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u))))}function x(t){return t*(Math.PI/180)}var g=n(0),_="locations",C=Object(r.createContext)(),w=Object(r.createContext)();function y(){return Object(r.useContext)(C)}function S(){return Object(r.useContext)(w)}function k(t){var e=t.children,n=Object(r.useState)(N),a=Object(u.a)(n,2),c=a[0],o=a[1],i=Object(r.useState)(function(t){return{addLocation:D(t)}}(o)),s=Object(u.a)(i,1)[0];return Object(r.useEffect)((function(){!function(t){localStorage.setItem(_,JSON.stringify(t))}(c),console.log(c)}),[c]),Object(g.jsx)(C.Provider,{value:c,children:Object(g.jsx)(w.Provider,{value:s,children:e})})}function N(){var t=localStorage.getItem(_);return t?E(JSON.parse(t)):[]}function E(t){return t.sort((function(t,e){return t.name.localeCompare(e.name)})),t}var D=function(t){return function(e){var n=function(){if(!a)throw new Error("No coordinates have been captured");return a}();t((function(t){return E([].concat(Object(s.a)(t.filter((function(t){return t.name!==e}))),[{name:e,coords:n}]))}))}};function M(t){var e,n,a=t.onCancel,o=t.onComplete,i=y(),s=S().addLocation,l=Object(r.useState)(0===Object.keys(i).length),j=Object(u.a)(l,2),b=j[0],f=j[1],d=Object(r.useState)(!1),m=Object(u.a)(d,2),O=m[0],v=m[1],p=Object(r.useState)(null!==(e=null===(n=i[0])||void 0===n?void 0:n.name)&&void 0!==e?e:""),h=Object(u.a)(p,2),x=h[0],_=h[1],C=!x;return Object(r.useEffect)((function(){O&&i.find((function(t){return t.name===x}))&&o(x)}),[o,i,x,O]),Object(c.createPortal)(Object(g.jsxs)("dialog",{className:"location form",open:!0,children:[b?Object(g.jsxs)(g.Fragment,{children:[Object(g.jsx)("label",{className:"form__label",children:"Location name:"}),Object(g.jsx)("input",{className:"form__field form__field--text",type:"text",name:"location-name",value:x,onChange:function(t){return _(t.target.value)},autoComplete:"off","data-form-type":"other"})]}):Object(g.jsxs)(g.Fragment,{children:[Object(g.jsx)("label",{className:"form__label",children:"Location:"}),Object(g.jsx)("select",{className:"form__field form__field--select",name:"location-name",value:x,onChange:function(t){return _(t.target.value)},children:Object.values(i).map((function(t){return Object(g.jsx)("option",{className:"form__field--option",value:t.name,children:t.name})}))})]}),Object(g.jsxs)("section",{className:"form__actions",children:[!b&&Object(g.jsx)("button",{className:"form__button",onClick:function(){return f(!0)},children:"Create new location"}),Object(g.jsx)("button",{className:"form__button",onClick:a,children:"Cancel"}),Object(g.jsx)("button",{className:"form__button form__button--cta",onClick:function(){s(x),v(!0)},disabled:C,children:"Submit"})]})]}),document.getElementById("modal-root"))}var I=n(6),P=n(2),L="timesheet-",F=Object(r.createContext)(),H=Object(r.createContext)(null);function J(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.allDays,a=void 0!==n&&n,c=Object(r.useContext)(F);if(a)return c;var o=c.date;return null!==(t=c[b(o)])&&void 0!==t?t:W(o)}function T(){return Object(r.useContext)(H)}function q(t){var e=t.children,n=Object(r.useState)(z),a=Object(u.a)(n,2),c=a[0],o=a[1],i=Object(r.useState)(function(t){return{addEvent:G(t),deleteEvent:K(t),updateEvent:Q(t),changeDate:V(t)}}(o)),s=Object(u.a)(i,1)[0];return Object(r.useEffect)((function(){!function(t){for(var e=0,n=Object.keys(t);e<n.length;e++){var a=n[e];if(/^\d{4}-/.test(a)){var c="".concat(L).concat(a);localStorage.setItem(c,B(t[a]))}}}(c),console.log(c)}),[c]),Object(g.jsx)(F.Provider,{value:c,children:Object(g.jsx)(H.Provider,{value:s,children:e})})}function z(){for(var t={date:f()},e=0,n=Object.keys(localStorage);e<n.length;e++){var a=n[e];if(a.startsWith(L))t[a.replace(L,"")]=A(localStorage.getItem(a))}return t}function A(t){var e=JSON.parse(t);return e.date=new Date(e.date),e.events.forEach((function(t){t.timestamp=new Date(t.timestamp)})),e}function B(t){return JSON.stringify(Object(P.a)(Object(P.a)({},t),{},{date:t.date.toISOString(),events:t.events.map((function(t){return Object(P.a)(Object(P.a)({},t),{},{timestamp:t.timestamp.toISOString()})}))}))}var R="0123456789abcdef";function U(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32,e=R.length,n="",a=0;a<t;a++)n+=R[Math.random()*e|0];return n}function W(t){return{date:f(t),events:[]}}var G=function(t){return function(e){t((function(t){var n,a=b(e.timestamp),c=null!==(n=t[a])&&void 0!==n?n:W(e.timestamp);return Object(P.a)(Object(P.a)({},t),{},Object(I.a)({},a,Object(P.a)(Object(P.a)({},c),{},{events:[].concat(Object(s.a)(c.events),[Object(P.a)({id:U()},e)])})))}))}},K=function(t){return function(e){t((function(t){var n=b(e.timestamp),a=t[n];return Object(P.a)(Object(P.a)({},t),{},Object(I.a)({},n,Object(P.a)(Object(P.a)({},a),{},{events:a.events.filter((function(t){return t.id!==e.id}))})))}))}},Q=function(t){return function(e){t((function(t){var n=b(e.timestamp),a=t[n];return Object(P.a)(Object(P.a)({},t),{},Object(I.a)({},n,Object(P.a)(Object(P.a)({},a),{},{events:a.events.map((function(t){return t.id!==e.id?t:e}))})))}))}},V=function(t){return function(e){t((function(t){var n=new Date(t.date);return n.setDate(n.getDate()+e),Object(P.a)(Object(P.a)({},t),{},{date:n})}))}},X={"clock-in":"Clock in",meal:"Meal","clock-out":"Clock out"};function Y(){var t=J().date,e=y(),n=T().addEvent,a=S().addLocation,c=Object(r.useState)(),s=Object(u.a)(c,2),l=s[0],j=s[1],f=Object(r.useState)(!1),d=Object(u.a)(f,2),m=d[0],O=d[1],v=b(t)===b(),p=Object(r.useCallback)(function(){var t=Object(i.a)(Object(o.a)().mark((function t(e,a){var c;return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return O(!0),t.prev=1,t.next=4,$(a);case 4:if(c=t.sent){t.next=8;break}return j(e),t.abrupt("return");case 8:n(Z(e,c)),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(1),alert("Couldn't create ".concat(e," event: ").concat(t.t0));case 14:O(!1);case 15:case"end":return t.stop()}}),t,null,[[1,11]])})));return function(e,n){return t.apply(this,arguments)}}(),[n]),h=Object(r.useCallback)((function(){j(void 0),O(!1)}),[]),x=Object(r.useCallback)((function(t){a(t),n(Z(l,t)),j(void 0),O(!1)}),[l,n,a]);return Object(g.jsxs)(g.Fragment,{children:[Object(g.jsx)("section",{className:"controls",children:Object.entries(X).map((function(t){var n=Object(u.a)(t,2),a=n[0],c=n[1];return Object(g.jsx)("button",{className:"controls__button controls__button--".concat(a),onClick:function(){return p(a,e)},disabled:m||!v,children:c},a)}))}),!!l&&Object(g.jsx)(M,{onCancel:h,onComplete:x})]})}function Z(t,e){return{type:t,location:e,timestamp:new Date}}function $(t){return tt.apply(this,arguments)}function tt(){return(tt=Object(i.a)(Object(o.a)().mark((function t(e){var n,a,c,r;return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,v();case 2:n=t.sent,a=0,c=Object.values(e);case 4:if(!(a<c.length)){t.next=11;break}if(r=c[a],!(h(n,r.coords)<60)){t.next=8;break}return t.abrupt("return",r.name);case 8:a++,t.next=4;break;case 11:return t.abrupt("return",null);case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function et(t){var e,n=t.event,a=t.parentHeight,c=void 0===a?1200:a,o=T().deleteEvent,i=Object(r.useState)(""),s=Object(u.a)(i,2),l=s[0],j=s[1];return Object(r.useEffect)((function(){var t=new Date(n.timestamp),e=60*t.getHours()+t.getMinutes();j("".concat((c*e/1440).toFixed(0),"px"))}),[n.timestamp,c]),l?Object(g.jsxs)("article",{className:"event event--".concat(n.type),style:{top:l},children:[(e=n.type,e.split(/\s+|,|-/).map((function(t){return t[0].toUpperCase()})).join("")),": ",n.location,"@",m(n.timestamp),Object(g.jsx)("button",{className:"event__action",onClick:function(){return o(n)},children:"\xd7"})]}):null}var nt=function(){var t=f();return Array(24).fill().map((function(e,n){var a=m(t);return t.setHours(t.getHours()+1),a}))}();function at(){var t=J().events,e=void 0===t?[]:t;return Object(g.jsx)(g.Fragment,{children:Object(g.jsxs)("section",{className:"day",children:[nt.map((function(t,e){return Object(g.jsx)("div",{className:"day__timeslot","data-time":t},"slot-".concat(e))})),e.map((function(t){return Object(g.jsx)(et,{event:t},t.id)}))]})})}function ct(){var t=J().date,e=T().changeDate,n=b(t)===b();return Object(g.jsxs)("section",{className:O("nav",n&&"nav--today"),children:[Object(g.jsx)("button",{className:"nav__action",onClick:function(){return e(-1)},children:"\u2039"}),Object(g.jsx)("h3",{className:"nav__title",children:d(t)}),Object(g.jsx)("button",{className:"nav__action",onClick:function(){return e(1)},disabled:n,children:"\u203a"})]})}function rt(){return Object(r.useLayoutEffect)((function(){function t(){var t=window.innerHeight;document.documentElement.style.setProperty("--vh-100","".concat(t,"px"))}return window.addEventListener("resize",t),t(),function(){return window.removeEventListener("resize",t)}}),[]),Object(g.jsx)(k,{children:Object(g.jsx)(q,{children:Object(g.jsxs)("main",{className:"app",children:[Object(g.jsx)(ct,{}),Object(g.jsx)(at,{}),Object(g.jsx)(Y,{})]})})})}Object(c.createRoot)(document.getElementById("root")).render(Object(g.jsx)(rt,{}))}},[[22,1,2]]]);
//# sourceMappingURL=main.7dcf896e.chunk.js.map
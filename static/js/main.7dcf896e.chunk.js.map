{"version":3,"sources":["utils.js","_locations-state.js","_location-dialog.js","_timesheet-state.js","_controls.js","_event.js","_day.js","_nav.js","_app.js","index.js"],"names":["lastCoords","DAY_FORMAT","Intl","DateTimeFormat","dateStyle","TIME_FORMAT","hour","minute","dateKey","date","startOfDay","toISOString","split","Date","start","setHours","setMinutes","setSeconds","setMilliseconds","formatDay","format","formatTime","cn","args","filter","arg","join","getCurrentCoordinates","Promise","res","rej","navigator","geolocation","getCurrentPosition","error","coords","latitude","longitude","getDistance","lat1","lon1","lat2","lon2","deltaLat","deg2rad","deltaLon","a","Math","sin","cos","atan2","sqrt","deg","PI","STORAGE_KEY","LocationsContext","createContext","LocationsApiContext","useLocations","useContext","useLocationsApi","LocationsProvider","children","useState","readFromStorage","locations","setLocations","addLocation","createApi","locationsApi","useEffect","localStorage","setItem","JSON","stringify","writeToStorage","console","log","Provider","value","locationsJson","getItem","sort","parse","b","name","localeCompare","Error","getLastCoordinates","loc","LocationDialog","onCancel","onComplete","Object","keys","length","isNew","setIsNew","isComplete","setIsComplete","setName","isInvalid","find","createPortal","className","open","type","onChange","e","target","autoComplete","values","map","location","onClick","disabled","document","getElementById","DAY_DATA_STORAGE_PREFIX","TimesheetContext","TimesheetApiContext","useTimesheetData","allDays","timesheetData","defaultDayData","useTimesheetApi","TimesheetProvider","setTimesheetData","addEvent","deleteEvent","updateEvent","changeDate","timesheetApi","key","test","storageKey","serialize","startsWith","replace","deserialize","dayData","parsedDayData","events","forEach","event","timestamp","CHARS","randomId","len","size","id","i","random","eventData","data","days","setDate","getDate","BUTTONS","meal","Controls","pendingType","setPendingType","isBusy","setIsBusy","isToday","onCreateEvent","useCallback","findLocation","createEvent","alert","onCancelLocation","undefined","onCompleteLocation","entries","label","Event","input","parentHeight","top","setTop","minsFromMidnight","getHours","getMinutes","HOURS_PER_DAY","toFixed","style","w","toUpperCase","SLOTS","Array","fill","_","formattedTime","createSlots","Day","time","Nav","App","useLayoutEffect","onResize","height","window","innerHeight","documentElement","setProperty","addEventListener","removeEventListener","createRoot","render"],"mappings":"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","file":"static/js/main.7dcf896e.chunk.js","sourcesContent":["const DAY_FORMAT = new Intl.DateTimeFormat(\"default\", {\n  dateStyle: \"medium\"\n});\n\nconst TIME_FORMAT = new Intl.DateTimeFormat(\"default\", {\n  hour: \"2-digit\",\n  minute: \"2-digit\"\n});\n\nconst EARTH_RADIUS_KM = 6371;\n\nexport function dateKey(date) {\n  return startOfDay(date).toISOString().split(\"T\")[0];\n}\n\nexport function startOfDay(date = new Date()) {\n  const start = new Date(date);\n\n  start.setHours(0);\n  start.setMinutes(0);\n  start.setSeconds(0);\n  start.setMilliseconds(0);\n\n  return start;\n}\n\nexport function formatDay(date) {\n  return DAY_FORMAT.format(new Date(date));\n}\n\nexport function formatTime(date) {\n  return TIME_FORMAT.format(new Date(date));\n}\n\nexport function cn(...args) {\n  return args.filter((arg) => !!arg).join(\" \");\n}\n\nexport function abbrev(input) {\n  return input\n    .split(/\\s+|,|-/)\n    .map((w) => w[0].toUpperCase())\n    .join(\"\");\n}\n\nlet lastCoords;\n\nexport async function getCurrentCoordinates() {\n  const {\n    coords: { latitude, longitude }\n  } = await new Promise((res, rej) => {\n    navigator.geolocation.getCurrentPosition(res, (error) => {\n      rej(error);\n    });\n  });\n\n  lastCoords = { latitude, longitude };\n  return lastCoords;\n}\n\nexport function getLastCoordinates() {\n  if (!lastCoords) {\n    throw new Error(\"No coordinates have been captured\");\n  }\n\n  return lastCoords;\n}\n\nexport function getDistance(\n  { latitude: lat1, longitude: lon1 },\n  { latitude: lat2, longitude: lon2 }\n) {\n  var deltaLat = deg2rad(lat2 - lat1);\n  var deltaLon = deg2rad(lon2 - lon1);\n  var a =\n    Math.sin(deltaLat / 2) * Math.sin(deltaLat / 2) +\n    Math.cos(deg2rad(lat1)) *\n      Math.cos(deg2rad(lat2)) *\n      Math.sin(deltaLon / 2) ** 2;\n  var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n  var d = EARTH_RADIUS_KM * c;\n  return d * 1000;\n}\n\nfunction deg2rad(deg) {\n  return deg * (Math.PI / 180);\n}\n","import { createContext, useContext, useEffect, useState } from \"react\";\n\nimport { getLastCoordinates } from \"./utils\";\n\nconst STORAGE_KEY = \"locations\";\n\nconst LocationsContext = createContext();\nconst LocationsApiContext = createContext();\n\nexport function useLocations() {\n  return useContext(LocationsContext);\n}\n\nexport function useLocationsApi() {\n  return useContext(LocationsApiContext);\n}\n\nexport function LocationsProvider({ children }) {\n  const [locations, setLocations] = useState(readFromStorage);\n  const [locationsApi] = useState(createApi(setLocations));\n\n  useEffect(() => {\n    writeToStorage(locations);\n    console.log(locations);\n  }, [locations]);\n\n  return (\n    <LocationsContext.Provider value={locations}>\n      <LocationsApiContext.Provider value={locationsApi}>\n        {children}\n      </LocationsApiContext.Provider>\n    </LocationsContext.Provider>\n  );\n}\n\nfunction readFromStorage() {\n  const locationsJson = localStorage.getItem(STORAGE_KEY);\n  return locationsJson ? sort(JSON.parse(locationsJson)) : [];\n}\n\nfunction writeToStorage(locations) {\n  localStorage.setItem(STORAGE_KEY, JSON.stringify(locations));\n}\n\nfunction createApi(setLocations) {\n  return {\n    addLocation: addLocation(setLocations)\n  };\n}\n\nfunction sort(locations) {\n  locations.sort((a, b) => a.name.localeCompare(b.name));\n  return locations;\n}\n\nconst addLocation = (setLocations) => (name) => {\n  const coords = getLastCoordinates();\n  setLocations((locations) =>\n    sort([...locations.filter((loc) => loc.name !== name), { name, coords }])\n  );\n};\n","import { useEffect, useState } from \"react\";\nimport { createPortal } from \"react-dom\";\n\nimport { useLocations, useLocationsApi } from \"./_locations-state\";\n\nexport function LocationDialog({ onCancel, onComplete }) {\n  const locations = useLocations();\n  const { addLocation } = useLocationsApi();\n\n  const [isNew, setIsNew] = useState(Object.keys(locations).length === 0);\n  const [isComplete, setIsComplete] = useState(false);\n  const [name, setName] = useState(locations[0]?.name ?? \"\");\n  const isInvalid = !name;\n\n  useEffect(() => {\n    if (isComplete && locations.find((loc) => loc.name === name)) {\n      onComplete(name);\n    }\n  }, [onComplete, locations, name, isComplete]);\n\n  return createPortal(\n    <dialog className=\"location form\" open>\n      {isNew ? (\n        <>\n          <label className=\"form__label\">Location name:</label>\n          <input\n            className=\"form__field form__field--text\"\n            type=\"text\"\n            name=\"location-name\"\n            value={name}\n            onChange={(e) => setName(e.target.value)}\n            autoComplete=\"off\"\n            data-form-type=\"other\"\n          />\n        </>\n      ) : (\n        <>\n          <label className=\"form__label\">Location:</label>\n          <select\n            className=\"form__field form__field--select\"\n            name=\"location-name\"\n            value={name}\n            onChange={(e) => setName(e.target.value)}\n          >\n            {Object.values(locations).map((location) => (\n              <option className=\"form__field--option\" value={location.name}>\n                {location.name}\n              </option>\n            ))}\n          </select>\n        </>\n      )}\n      <section className=\"form__actions\">\n        {!isNew && (\n          <button className=\"form__button\" onClick={() => setIsNew(true)}>\n            Create new location\n          </button>\n        )}\n        <button className=\"form__button\" onClick={onCancel}>\n          Cancel\n        </button>\n        <button\n          className=\"form__button form__button--cta\"\n          onClick={() => {\n            addLocation(name);\n            setIsComplete(true);\n          }}\n          disabled={isInvalid}\n        >\n          Submit\n        </button>\n      </section>\n    </dialog>,\n    document.getElementById(\"modal-root\")\n  );\n}\n","import { createContext, useContext, useEffect, useState } from \"react\";\n\nimport { dateKey, startOfDay } from \"./utils\";\n\nconst DAY_DATA_STORAGE_PREFIX = \"timesheet-\";\n\nconst TimesheetContext = createContext();\nconst TimesheetApiContext = createContext(null);\n\nexport function useTimesheetData({ allDays = false } = {}) {\n  const timesheetData = useContext(TimesheetContext);\n\n  if (allDays) {\n    return timesheetData;\n  }\n\n  const { date } = timesheetData;\n  return timesheetData[dateKey(date)] ?? defaultDayData(date);\n}\n\nexport function useTimesheetApi() {\n  return useContext(TimesheetApiContext);\n}\n\nexport function TimesheetProvider({ children }) {\n  const [timesheetData, setTimesheetData] = useState(readFromStorage);\n  const [timesheetApi] = useState(createApi(setTimesheetData));\n\n  useEffect(() => {\n    writeToStorage(timesheetData);\n    console.log(timesheetData);\n  }, [timesheetData]);\n\n  return (\n    <TimesheetContext.Provider value={timesheetData}>\n      <TimesheetApiContext.Provider value={timesheetApi}>\n        {children}\n      </TimesheetApiContext.Provider>\n    </TimesheetContext.Provider>\n  );\n}\n\nfunction readFromStorage() {\n  const timesheetData = {\n    date: startOfDay()\n  };\n\n  for (const storageKey of Object.keys(localStorage)) {\n    if (!storageKey.startsWith(DAY_DATA_STORAGE_PREFIX)) {\n      continue;\n    }\n\n    const key = storageKey.replace(DAY_DATA_STORAGE_PREFIX, \"\");\n    timesheetData[key] = deserialize(localStorage.getItem(storageKey));\n  }\n\n  return timesheetData;\n}\n\nfunction writeToStorage(timesheetData) {\n  for (const key of Object.keys(timesheetData)) {\n    if (!/^\\d{4}-/.test(key)) {\n      continue;\n    }\n\n    const storageKey = `${DAY_DATA_STORAGE_PREFIX}${key}`;\n    localStorage.setItem(storageKey, serialize(timesheetData[key]));\n  }\n}\n\nfunction deserialize(dayData) {\n  const parsedDayData = JSON.parse(dayData);\n\n  parsedDayData.date = new Date(parsedDayData.date);\n  parsedDayData.events.forEach((event) => {\n    event.timestamp = new Date(event.timestamp);\n  });\n\n  return parsedDayData;\n}\n\nfunction serialize(dayData) {\n  return JSON.stringify({\n    ...dayData,\n    date: dayData.date.toISOString(),\n    events: dayData.events.map((event) => ({\n      ...event,\n      timestamp: event.timestamp.toISOString()\n    }))\n  });\n}\n\nfunction createApi(setTimesheetData) {\n  return {\n    addEvent: addEvent(setTimesheetData),\n    deleteEvent: deleteEvent(setTimesheetData),\n    updateEvent: updateEvent(setTimesheetData),\n    changeDate: changeDate(setTimesheetData)\n  };\n}\n\nconst CHARS = \"0123456789abcdef\";\nfunction randomId(len = 32) {\n  const size = CHARS.length;\n  let id = \"\";\n\n  for (let i = 0; i < len; i++) {\n    id += CHARS[(Math.random() * size) | 0];\n  }\n\n  return id;\n}\n\nfunction defaultDayData(date) {\n  return {\n    date: startOfDay(date),\n    events: []\n  };\n}\n\nconst addEvent = (setTimesheetData) => (eventData) => {\n  setTimesheetData((data) => {\n    const key = dateKey(eventData.timestamp);\n    const dayData = data[key] ?? defaultDayData(eventData.timestamp);\n\n    return {\n      ...data,\n      [key]: {\n        ...dayData,\n        events: [...dayData.events, { id: randomId(), ...eventData }]\n      }\n    };\n  });\n};\n\nconst deleteEvent = (setTimesheetData) => (eventData) => {\n  setTimesheetData((data) => {\n    const key = dateKey(eventData.timestamp);\n    const dayData = data[key];\n\n    return {\n      ...data,\n      [key]: {\n        ...dayData,\n        events: dayData.events.filter((event) => event.id !== eventData.id)\n      }\n    };\n  });\n};\n\nconst updateEvent = (setTimesheetData) => (eventData) => {\n  setTimesheetData((data) => {\n    const key = dateKey(eventData.timestamp);\n    const dayData = data[key];\n\n    return {\n      ...data,\n      [key]: {\n        ...dayData,\n        events: dayData.events.map((event) =>\n          event.id !== eventData.id ? event : eventData\n        )\n      }\n    };\n  });\n};\n\nconst changeDate = (setTimesheetData) => (days) => {\n  setTimesheetData((data) => {\n    const date = new Date(data.date);\n\n    date.setDate(date.getDate() + days);\n\n    return {\n      ...data,\n      date\n    };\n  });\n};\n","import { useCallback, useState } from \"react\";\n\nimport { LocationDialog } from \"./_location-dialog\";\nimport { dateKey, getCurrentCoordinates, getDistance } from \"./utils\";\nimport { useTimesheetApi, useTimesheetData } from \"./_timesheet-state\";\nimport { useLocations, useLocationsApi } from \"./_locations-state\";\n\nconst BUTTONS = {\n  \"clock-in\": \"Clock in\",\n  meal: \"Meal\",\n  \"clock-out\": \"Clock out\"\n};\n\nexport function Controls() {\n  const { date } = useTimesheetData();\n  const locations = useLocations();\n  const { addEvent } = useTimesheetApi();\n  const { addLocation } = useLocationsApi();\n  const [pendingType, setPendingType] = useState();\n  const [isBusy, setIsBusy] = useState(false);\n\n  const isToday = dateKey(date) === dateKey();\n\n  const onCreateEvent = useCallback(\n    async (type, locations) => {\n      setIsBusy(true);\n      try {\n        const location = await findLocation(locations);\n        if (!location) {\n          setPendingType(type);\n          return;\n        }\n\n        addEvent(createEvent(type, location));\n      } catch (e) {\n        alert(`Couldn't create ${type} event: ${e}`);\n      }\n      setIsBusy(false);\n    },\n    [addEvent]\n  );\n\n  const onCancelLocation = useCallback(() => {\n    setPendingType(undefined);\n    setIsBusy(false);\n  }, []);\n\n  const onCompleteLocation = useCallback(\n    (location) => {\n      addLocation(location);\n      addEvent(createEvent(pendingType, location));\n      setPendingType(undefined);\n      setIsBusy(false);\n    },\n    [pendingType, addEvent, addLocation]\n  );\n\n  return (\n    <>\n      <section className=\"controls\">\n        {Object.entries(BUTTONS).map(([type, label]) => (\n          <button\n            key={type}\n            className={`controls__button controls__button--${type}`}\n            onClick={() => onCreateEvent(type, locations)}\n            disabled={isBusy || !isToday}\n          >\n            {label}\n          </button>\n        ))}\n      </section>\n      {!!pendingType && (\n        <LocationDialog\n          onCancel={onCancelLocation}\n          onComplete={onCompleteLocation}\n        />\n      )}\n    </>\n  );\n}\n\nfunction createEvent(type, location) {\n  return {\n    type,\n    location,\n    timestamp: new Date()\n  };\n}\n\nconst RADIUS_M = 60;\nasync function findLocation(locations) {\n  const coords = await getCurrentCoordinates();\n\n  for (let location of Object.values(locations)) {\n    if (getDistance(coords, location.coords) < RADIUS_M) {\n      return location.name;\n    }\n  }\n\n  return null;\n}\n","import { useEffect, useState } from \"react\";\n\nimport { abbrev, formatTime } from \"./utils\";\nimport { useTimesheetApi } from \"./_timesheet-state\";\n\nconst MINS_PER_HOUR = 60;\nconst HOURS_PER_DAY = 24;\nconst MINS_PER_DAY = HOURS_PER_DAY * MINS_PER_HOUR;\n\nexport function Event({ event, parentHeight = 1200 }) {\n  const { deleteEvent } = useTimesheetApi();\n  const [top, setTop] = useState(\"\");\n\n  useEffect(() => {\n    const timestamp = new Date(event.timestamp);\n    const minsFromMidnight =\n      timestamp.getHours() * MINS_PER_HOUR + timestamp.getMinutes();\n\n    setTop(\n      `${((parentHeight * minsFromMidnight) / MINS_PER_DAY).toFixed(0)}px`\n    );\n  }, [event.timestamp, parentHeight]);\n\n  if (!top) {\n    return null;\n  }\n\n  return (\n    <article className={`event event--${event.type}`} style={{ top }}>\n      {abbrev(event.type)}: {event.location}@{formatTime(event.timestamp)}\n      <button className=\"event__action\" onClick={() => deleteEvent(event)}>\n        &times;\n      </button>\n    </article>\n  );\n}\n","import { Event } from \"./_event\";\nimport { formatTime, startOfDay } from \"./utils\";\nimport { useTimesheetData } from \"./_timesheet-state\";\n\nconst SLOTS = createSlots();\n\nexport function Day() {\n  const { events = [] } = useTimesheetData();\n\n  return (\n    <>\n      <section className=\"day\">\n        {SLOTS.map((time, i) => (\n          <div\n            key={`slot-${i}`}\n            className=\"day__timeslot\"\n            data-time={time}\n          ></div>\n        ))}\n        {events.map((event) => (\n          <Event key={event.id} event={event} />\n        ))}\n      </section>\n    </>\n  );\n}\n\nfunction createSlots() {\n  const date = startOfDay();\n\n  return Array(24)\n    .fill()\n    .map((_, i) => {\n      const formattedTime = formatTime(date);\n\n      date.setHours(date.getHours() + 1);\n\n      return formattedTime;\n    });\n}\n","import React from \"react\";\nimport { cn, dateKey, formatDay } from \"./utils\";\nimport { useTimesheetApi, useTimesheetData } from \"./_timesheet-state\";\n\nexport function Nav() {\n  const { date } = useTimesheetData();\n  const { changeDate } = useTimesheetApi();\n\n  const isToday = dateKey(date) === dateKey();\n\n  return (\n    <section className={cn(\"nav\", isToday && \"nav--today\")}>\n      <button className=\"nav__action\" onClick={() => changeDate(-1)}>\n        &lsaquo;\n      </button>\n      <h3 className=\"nav__title\">{formatDay(date)}</h3>\n      <button\n        className=\"nav__action\"\n        onClick={() => changeDate(1)}\n        disabled={isToday}\n      >\n        &rsaquo;\n      </button>\n    </section>\n  );\n}\n","import { useLayoutEffect } from \"react\";\n\nimport { Controls } from \"./_controls\";\nimport { Day } from \"./_day\";\nimport { Nav } from \"./_nav\";\nimport { LocationsProvider } from \"./_locations-state\";\nimport { TimesheetProvider } from \"./_timesheet-state\";\n\nimport { LocationDialog } from \"./_location-dialog\";\n\nexport function App() {\n  useLayoutEffect(() => {\n    function onResize() {\n      const height = window.innerHeight;\n      document.documentElement.style.setProperty(\"--vh-100\", `${height}px`);\n    }\n\n    window.addEventListener(\"resize\", onResize);\n    onResize();\n\n    return () => window.removeEventListener(\"resize\", onResize);\n  }, []);\n\n  return (\n    <LocationsProvider>\n      <TimesheetProvider>\n        <main className=\"app\">\n          <Nav />\n          <Day />\n          <Controls />\n        </main>\n      </TimesheetProvider>\n    </LocationsProvider>\n  );\n\n  return (\n    <LocationsProvider>\n      <LocationDialog />\n    </LocationsProvider>\n  );\n}\n","import { createRoot } from \"react-dom\";\nimport { App } from \"./_app\";\n\ncreateRoot(document.getElementById(\"root\")).render(<App />);\n"],"sourceRoot":""}